<div class="content" >
  <header>
    <!-- {{appS.taskLiveState}} -- {{PLCS.tcp?.linkMsg?.state}} -->
    <div class="state" *ngIf="plcState && templateData">
      <nz-alert  [nzType]="!PLCS.heartbeatState ? 'success' : 'error'" [nzMessage]="!PLCS.heartbeatState ? '正在监控中' : '监控已停止'"></nz-alert>
    </div>
    <div class="live" >
      <!-- <h2>监控压浆：</h2> -->
      <nz-alert *ngIf="appS.taskLiveState" nzType="success" [nzMessage]="'梁号：' + now.name"></nz-alert>
      <nz-alert *ngIf="appS.taskLiveState" nzType="info" [nzMessage]="'孔号：' + now.holeName"></nz-alert>
      <nz-alert nzType="success" *ngIf="templateData" [nzMessage]="'模板：' + templateData.component + '/' + templateData.name"></nz-alert>
    </div>
    <nz-alert *ngIf="!plcState" nzType="error" nzMessage="设备未连接，请链接设备！！"></nz-alert>
    <nz-alert *ngIf="!templateData" nzType="error" nzMessage="请选择模板" (click)="groutingTemplateShow = true"></nz-alert>
    <div class="template">
      <button nz-button nzType="primary" (click)="groutingTemplateShow = true" >{{templateData ? '更换模板' : '选择模板'}}</button>
      <button nz-button [nzType]="stop ? 'info' : 'danger'" *ngIf="templateData" (click)="operatorLive()">{{appS.taskLiveState ? '取消监控' : '开始监控'}}</button>
      <!-- <button nz-button nzType="danger" *ngIf="appS.taskLiveState && !plcState" (click)="appS.taskLiveState = false">停止监控</button> -->
    </div>
  </header>
  <main *ngIf="templateData" class="scroll-y" >
      <div class="scroll-content">
        <!-- <div>
          {{templateData.groutingInfo[0].groups[0] | json}}
        </div> -->
        <div class="micing">
          <nz-divider style="min-width: auto;" nzText="搅拌监控" nzOrientation="center"></nz-divider>
          <table class="gridtable">
            <thead>
              <tr>
                <th></th>
                <th *ngFor="let item of templateData.proportionInfo.proportions" >{{item.name}}(kg)</th>
                <th>水胶比</th>
                <th>搅拌时间(s)</th>
                <th *ngIf="appS.groutingDevicesInfo.waterTemperature || appS.groutingDevicesInfo.envTemperature">水/环境温度(℃)</th>
              </tr>
            </thead>
            <tbody>
              <ng-container>
                <tr>
                  <td>设置配比</td>
                  <td *ngFor="let item of templateData.proportionInfo.proportions">{{item.value}}</td>
                  <td>{{templateData.proportionInfo.waterBinderRatio}}</td>
                  <!-- <td><input type="number" nz-input placeholder="搅拌时间"></td> -->
                  <td></td>
                </tr>
                <tr>
                  <td>设置搅拌数据</td>
                  <td *ngFor="let item of templateData.proportionInfo.proportions; index as i">{{mixingData?.dosage[i]}}</td>
                  <td>{{mixingData?.waterBinderRatio}}</td>
                  <td rowspan="2">{{mixingData?.mixingTime}}</td>
                  <td *ngIf="appS.groutingDevicesInfo.waterTemperature || appS.groutingDevicesInfo.envTemperature">
                    <div class="row" *ngIf="appS.groutingDevicesInfo.waterTemperature">
                      水: {{mixingData?.waterTemperature}}
                    </div>
                    <div class="row" *ngIf="appS.groutingDevicesInfo.envTemperature">
                      环: {{mixingData?.envTemperature}}
                    </div>
                  </td>
                </tr>
                <tr>
                  <td>上料搅拌数据</td>
                  <td *ngFor="let item of templateData.proportionInfo.proportions; index as i">{{now.dosage[i]}}</td>
                  <td>{{now.waterBinderRatio}}</td>
                  <!-- <td>{{mixingData?.mixingTime}}</td> -->
                </tr>
              </ng-container>
            </tbody>
          </table>
        </div>
        <div class="grouting">
          <nz-divider style="min-width: auto;" nzText="压浆监控" nzOrientation="center"></nz-divider>
          <table class="gridtable">
            <thead>
              <tr>
                <th>设置压力</th>
                <th *ngIf="appS.groutingDevicesInfo.intoPulpPressure">进浆压力</th>
                <th *ngIf="appS.groutingDevicesInfo.outPulpPressure">回浆压力</th>
                <th *ngIf="appS.groutingDevicesInfo.intoPulpvolume">进浆量</th>
                <th *ngIf="appS.groutingDevicesInfo.outPulpvolume">回浆量</th>
                <th>保压时间</th>
                <th *ngIf="appS.groutingDevicesInfo.slurryTemperature || appS.groutingDevicesInfo.envTemperature">浆液/环境温度(℃)</th>
              </tr>
            </thead>
            <tbody>
              <ng-container>
                <tr>
                  <td>{{ templateData.groutingInfo[0].groups[0].setGroutingPressure || ' 0.00' }}</td>
                  <td *ngIf="appS.groutingDevicesInfo.intoPulpPressure" >{{groutingHoleItem?.intoPulpPressure}}</td>
                  <td *ngIf="appS.groutingDevicesInfo.outPulpPressure" >{{groutingHoleItem?.outPulpPressure}}</td>
                  <td *ngIf="appS.groutingDevicesInfo.intoPulpvolume" >{{groutingHoleItem?.intoPulpvolume}}</td>
                  <td *ngIf="appS.groutingDevicesInfo.outPulpvolume" >{{groutingHoleItem?.outPulpvolume}}</td>
                  <td >{{groutingHoleItem?.steadyTime}}</td>
                  <td *ngIf="appS.groutingDevicesInfo.slurryTemperature || appS.groutingDevicesInfo.envTemperature">
                    <div class="row" *ngIf="appS.groutingDevicesInfo.slurryTemperature">
                      浆: {{groutingHoleItem?.slurryTemperature}}
                    </div>
                    <div class="row" *ngIf="appS.groutingDevicesInfo.envTemperature">
                      环: {{groutingHoleItem?.envTemperature}}
                    </div>
                  </td>
                </tr>
              </ng-container>
            </tbody>
          </table>
          <div>
            <br>
            <echarts-dynamic-line-grouting
              [height]="appS.groutingDevicesInfo.svgHeight"
              [live]="groutingHoleItem?.processDatas?.intoPulpPressure.length"
              [data]="groutingHoleItem?.processDatas?.intoPulpPressure.length > 0 ? groutingHoleItem?.processDatas : null"
              [satrtDate]="mixingDataNow.date"
              [subWidth]="0"
              ></echarts-dynamic-line-grouting>
          </div>
        </div>
    </div>
  </main>
</div>

<app-grouting-template *ngIf="groutingTemplateShow" (selectOut)="selectGroutingTemp($event)" (cancel)="groutingTemplateShow=false"></app-grouting-template>
