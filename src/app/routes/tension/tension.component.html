<app-left>
  <div class="sider sider-menu">
    <app-scroll-menu style="flex: 1;" [dbName]="dbName" [stateFunc]="menuStateFunc" #menu (menuChange)="selectBridge($event)"></app-scroll-menu>
  </div>
  <div class="main" style="width: 100%;">
    <div *ngIf="data?.template" class="task-template">
      <div class="text">模板</div>
    </div>
    <nz-tabset class="task-tabset" (nzSelectChange)="changeTabs($event)" [nzShowPagination]="false">
      <nz-tab nzTitle="基础信息">
        <div class="form-edit">
          <form nz-form [ngClass]="{'edit-on': appS.edit}" [formGroup]="formData" *ngIf="formData">
            <div>
              <app-form-item [row]="true" label="模板" [hidden]="!appS.edit">
                <nz-switch formControlName="template" nzCheckedChildren="是" nzUnCheckedChildren="否"></nz-switch>
              </app-form-item>
              <app-form-item label="梁号" [errors]="formData.get('name').errors">
                <input type="text" nz-input placeholder="请输入梁号" formControlName="name">
              </app-form-item>
              <app-form-item label="构建" [errors]="formData.get('component').errors">
                <nz-input-group class="tension-group" [nzAddOnAfter]="suffixButton">
                  <nz-select style="width: 100%;" nzPlaceHolder="请选择构建" formControlName="component"
                  (ngModelChange)="conponentChange($event)">
                    <nz-option [nzValue]="item.value" [nzLabel]="item.label"
                      *ngFor="let item of componentMneu$ | async">
                    </nz-option>
                  </nz-select>
                </nz-input-group>
                <ng-template #suffixButton>
                  <button nz-button nzType="primary" (click)="manualGroup()" [disabled]="!(formData.get('component').value)">分组</button>
                </ng-template>
              </app-form-item>
              <app-form-item label="梁长度" [errors]="formData.get('beamLength').errors">
                <input type="number" nz-input placeholder="请输入梁长度" formControlName="beamLength">
              </app-form-item>
              <app-form-item label="浇筑日期" [errors]="formData.get('castingDate').errors">
                 <nz-date-picker readonly formControlName="castingDate" placeholder="浇筑日期" [nzAllowClear]="false"></nz-date-picker>
              </app-form-item>
              <app-form-item label="张拉日期">
                 <nz-date-picker readonly formControlName="tensionDate" placeholder="张拉日期" [nzAllowClear]="false"></nz-date-picker>
              </app-form-item>

              <app-form-item label="施工员">
                <input type="text" nz-input placeholder="施工员" formControlName="operator">
              </app-form-item>
              <app-form-item label="监理员">
                <input type="text" nz-input placeholder="监理员" formControlName="supervisors">
              </app-form-item>
              <app-form-item label="自检员">
                <input type="text" nz-input placeholder="自检员" formControlName="qualityInspector">
              </app-form-item>
              <app-form-item label="张拉顺序" [row]="true">
                <input type="text" readonly nz-input placeholder="张拉顺序" [value]="sortJoin(formData?.get('sort').value)">
              </app-form-item>
            </div>
            <div>
              <app-add-other [formGroup]="formData" [edit]="appS.edit"></app-add-other>
            </div>
            <div>
              <tension-holes [data]="data" [formData]="formData" #holes (outSelectHole)="switchGorup($event)"></tension-holes>
            </div>
          </form>
          <div class="edit" *ngIf="!appS.edit"></div>
        </div>

        <div class="operation" *ngIf="menu?.projectId">
          <app-operat
            [dbName]="dbName"
            [formData]="formData"
            [addFilterFun]="addFilterFun"
            [updateFilterFun]="updateFilterFun"
            [coprState]="true"
            [valid]="formData?.valid"
            (outEdit)="onEdit($event)"
            (outEditOk)="editOk($event)"
            (outDelete)="delete()"
            (outCancelEdit)="cancelEdit()"
            (outModification)="onEdit('modification')"
            >
            <button nz-button nzType="primary" (click)="upload()"
              [disabled]="!(data?.groutingInfo?.length > 0) || !uploading"><i nz-icon nzType="cloud-upload"
                nzTheme="outline"></i>上传</button>
            <button nz-button nzType="primary" (click)="downHMI()"
              [disabled]="!(PLCS.connStr?.uid === 'tensionLink') || !(gourpItem.state !== 2)"
              *ngIf="data?.id !== null && PLCS.plcState && !appS.edit && holeIndex !== null">张拉</button>
            <button nz-button nzType="primary" (click)="test()" *ngIf="appS.userInfo.jurisdiction === 9">测试</button>
            <button nz-button nzType="primary" (click)="downHMITest()" *ngIf="appS.userInfo.jurisdiction === 9">测试张拉</button>
            <button nz-button nzType="primary" (click)="manualGroupOk(null)" *ngIf="appS.userInfo.jurisdiction === 9">测试分组</button>
          </app-operat>
        </div>
      </nz-tab>
      <nz-tab nzTitle="其他">
        <p>创建者：{{data?.user}}</p>
        <p>创建日期：{{data?.createdDate | date: "yyyy.MM.dd HH:mm"}}</p>
        <p>修改日期：{{data?.modificationDate | date: "yyyy.MM.dd HH:mm"}}</p>
      </nz-tab>
    </nz-tabset>
  </div>
</app-left>
<app-delete-modal *ngIf="deleteShow" (outDelete)="deleteOk($event)"></app-delete-modal>
<tension-manual-group *ngIf="mamualGroupState" (outCancel)="manualGroupCancel()" (outOK)="manualGroupOk($event)" [holes]="nowComponentHoleInfo"></tension-manual-group>
<nz-modal [(nzVisible)]="downState" nzTitle="下载数据" (nzOnCancel)="downState = false" [nzFooter]="null" nzMaskClosable="false" nzWidth="90%">
  <div style="display: flex; flex-direction: column; flex-direction: column;">
    <h1 style="margin-bottom: 15px;" *ngIf="downMsg.length === 0">{{upProgress === 0 ? '数据校验...' : '校验完成'}}</h1>
    <h1 style="margin-bottom: 15px; color: brown;" *ngIf="downMsg.length > 0">数据有误</h1>
    <div style="display: flex; flex-wrap: wrap;">
      <nz-alert nzType="error" [nzMessage]="item" *ngFor="let item of downMsg" style="margin: 0 10px 10px 0;"></nz-alert>
    </div>
    <!-- <div style="display: flex; align-items: center;">
      <nz-progress [nzPercent]="(upProgress / 9) * 100" nzType="circle" [nzWidth]="80"></nz-progress>
      <h1 style="margin-left: 25px;" *ngIf="downMsg.length === 0">{{upProgress < 9 ? '正在下载任务...' : '下载完成'}}</h1>
    </div> -->
  </div>
</nz-modal>

